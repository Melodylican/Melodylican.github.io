<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Spark," />





  <link rel="alternate" href="/rss2.xml" title="不卑不亢不慌不忙" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="对Scala代码进行打包编译时，可以采用Maven，也可以采用sbt，相对而言，业界更多使用sbt。这里介绍IntelliJ IDEA和Maven的组合使用方法。IntelliJ IDEA和SBT的组合使用方法，请参考“使用Intellij Idea编写Spark应用程序（Scala+SBT）”。">
<meta property="og:type" content="article">
<meta property="og:title" content="Spark入门 第二章 第三节 使用开发工具Intellij idea编写Spark应用程序(Scala+Maven)">
<meta property="og:url" content="http://Melodylican.github.io/2017/02/15/使用开发工具Intellij idea编写Spark应用程序(Scala+Maven)/index.html">
<meta property="og:site_name" content="不卑不亢不慌不忙">
<meta property="og:description" content="对Scala代码进行打包编译时，可以采用Maven，也可以采用sbt，相对而言，业界更多使用sbt。这里介绍IntelliJ IDEA和Maven的组合使用方法。IntelliJ IDEA和SBT的组合使用方法，请参考“使用Intellij Idea编写Spark应用程序（Scala+SBT）”。">
<meta property="og:image" content="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/1.png">
<meta property="og:image" content="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/2.png">
<meta property="og:image" content="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/3.png">
<meta property="og:image" content="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/4.png">
<meta property="og:image" content="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/5.png">
<meta property="og:image" content="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/6.png">
<meta property="og:image" content="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/7.png">
<meta property="og:image" content="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/8.png">
<meta property="og:image" content="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/25.png">
<meta property="og:image" content="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/9.png">
<meta property="og:image" content="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/10.png">
<meta property="og:image" content="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/11.png">
<meta property="og:image" content="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/12.png">
<meta property="og:image" content="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/13.png">
<meta property="og:image" content="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/14.png">
<meta property="og:image" content="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/15.png">
<meta property="og:image" content="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/16.png">
<meta property="og:image" content="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/17-1.png">
<meta property="og:image" content="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/18.png">
<meta property="og:image" content="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/19.png">
<meta property="og:image" content="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/20.png">
<meta property="og:image" content="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/21.png">
<meta property="og:image" content="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/22.png">
<meta property="og:image" content="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/23.png">
<meta property="og:updated_time" content="2017-06-29T05:54:51.162Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Spark入门 第二章 第三节 使用开发工具Intellij idea编写Spark应用程序(Scala+Maven)">
<meta name="twitter:description" content="对Scala代码进行打包编译时，可以采用Maven，也可以采用sbt，相对而言，业界更多使用sbt。这里介绍IntelliJ IDEA和Maven的组合使用方法。IntelliJ IDEA和SBT的组合使用方法，请参考“使用Intellij Idea编写Spark应用程序（Scala+SBT）”。">
<meta name="twitter:image" content="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/1.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://Melodylican.github.io/2017/02/15/使用开发工具Intellij idea编写Spark应用程序(Scala+Maven)/"/>





  <title> Spark入门 第二章 第三节 使用开发工具Intellij idea编写Spark应用程序(Scala+Maven) | 不卑不亢不慌不忙 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?b882a8b6fdb7e13666299576d25a043a";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">不卑不亢不慌不忙</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">life is struggle</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-collect">
          <a href="/collect" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-flag"></i> <br />
            
            收集
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocapitalize="off" autocomplete="off" autocorrect="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://Melodylican.github.io/2017/02/15/使用开发工具Intellij idea编写Spark应用程序(Scala+Maven)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Melodylican">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="不卑不亢不慌不忙">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Spark入门 第二章 第三节 使用开发工具Intellij idea编写Spark应用程序(Scala+Maven)
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-15T00:00:00+08:00">
                2017-02-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/笔记/" itemprop="url" rel="index">
                    <span itemprop="name">笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2017/02/15/使用开发工具Intellij idea编写Spark应用程序(Scala+Maven)/" class="leancloud_visitors" data-flag-title="Spark入门 第二章 第三节 使用开发工具Intellij idea编写Spark应用程序(Scala+Maven)">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>对Scala代码进行打包编译时，可以采用Maven，也可以采用sbt，相对而言，业界更多使用sbt。这里介绍IntelliJ IDEA和Maven的组合使用方法。IntelliJ IDEA和SBT的组合使用方法，请参考“使用Intellij Idea编写Spark应用程序（Scala+SBT）”。<br><a id="more"></a><br><div class="note success"><h2 id="1-安装IntelliJ-IDEA"><a href="#1-安装IntelliJ-IDEA" class="headerlink" title="1.安装IntelliJ IDEA"></a>1.安装IntelliJ IDEA</h2></div><br>本次运行系统为Ubuntu16.04。</p>
<p>我们可以访问<a href="http://www.jetbrains.com/idea/download/#section=linux" target="_blank" rel="external">官网</a>下载安装包。文件较大，一般需要20分钟左右。有两种下载选择，我们选择下载正版，教程将使用试用版的idea。<br>下载后，我们把压缩包解压并且改名。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> ~/下载</div><div class="line">sudo tar -zxvf ideaIU-2016.3.4.tar.gz</div><div class="line">sudo mv idea-IU-163.12024.16 /usr/<span class="built_in">local</span>/Intellij</div></pre></td></tr></table></figure></p>
<p>然后我们打开Intellij文件夹，并且使用其bin文件夹下的idea.sh打开程序。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/Intellij/bin</div><div class="line">./idea.sh</div></pre></td></tr></table></figure></p>
<p>会出现如图界面。<br><img src="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/1.png" alt=""><br>选择Ecalute for free进入免费试用版。<br>接下来我们要把程序放到启动栏里快捷启动。<br>首先进入到applications文件夹下，并且编辑idea.desktop文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /usr/share/applications</div><div class="line">sudo gedit idea.desktop</div></pre></td></tr></table></figure></p>
<p>在打开的文档里添加如下内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[Desktop Entry]</div><div class="line">Encoding=UTF-8</div><div class="line">Version=1.0</div><div class="line">Name=IntelliJ IDEA</div><div class="line">GenericName=Java IDE</div><div class="line">Comment=IntelliJ IDEA is a code-centric IDE focused on developer    productivity. The editor deeply understands your code and knows its way around the codebase, makes great suggestions right when you need them, and is always ready to help you shape your code.</div><div class="line">Exec=/usr/local/Intellij/bin/idea.sh</div><div class="line">Icon=/usr/local/Intellij/bin/idea.png</div><div class="line">Terminal=false</div><div class="line">Type=Application</div><div class="line">Categories=Development;IDE</div></pre></td></tr></table></figure></p>
<p>然后我们在启动栏里选择查找程序的那个应用（一般在启动栏第一个）。搜索Intellij即可找到程序，点击就可以启动idea。这时候我们就可以把程序锁定到启动栏使用了。如果搜索没找到，请重启系统。</p>
<div class="note success"><h2 id="2-在Intellij里安装scala插件，并配置JDK，scala-SDK"><a href="#2-在Intellij里安装scala插件，并配置JDK，scala-SDK" class="headerlink" title="2.在Intellij里安装scala插件，并配置JDK，scala SDK"></a>2.在Intellij里安装scala插件，并配置JDK，scala SDK</h2></div>
<p>首先如图打开plugins界面。<br><img src="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/2.png" alt=""><br>然后我们点击Install JetBrain Plugins..如下图<br><img src="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/3.png" alt=""><br>搜索并安装scala。<br>等待安装完成后我们就可以配置JDK跟scala SDK。</p>
<div class="note success"><h3 id="配置JDK"><a href="#配置JDK" class="headerlink" title="## 配置JDK ##"></a>## 配置JDK ##</h3></div>
<p>首先我们打开Project Structure，如下图。<br><img src="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/4.png" alt=""><br>然后我们添加JDK（这里默认已经安装JDK并且配置了环境变量），操作按下面两张图。<br><img src="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/5.png" alt=""><br><img src="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/6.png" alt=""><br><div class="note success"><h3 id="配置全局Scala-SDK"><a href="#配置全局Scala-SDK" class="headerlink" title="## 配置全局Scala SDK ##"></a>## 配置全局Scala SDK ##</h3></div><br>还是在Project Structure界面，操作如下。<br><img src="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/7.png" alt=""><br><img src="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/8.png" alt=""><br>然后我们右键我们添加的SDK选择Copy to Project Libraries…OK确认。如图<br><img src="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/25.png" alt=""><br>配置好后我们就可以创建工程文件了。</p>
<div class="note success"><h2 id="3-创建Maven工程文件"><a href="#3-创建Maven工程文件" class="headerlink" title="3.创建Maven工程文件"></a>3.创建Maven工程文件</h2></div>
<p>我们点击初始界面的Create New Project进入如图界面。并按图创建Maven工程文件。<br><img src="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/9.png" alt=""><br>然后我们要填写GroupId：dblab；以及ArtifactId：WordCount，如图<br><img src="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/10.png" alt=""><br>然后按下图填写各项，这一步容易出错请认真填写。<br><img src="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/11.png" alt=""><br>到此创建工程文件完成。</p>
<div class="note success"><h2 id="4-前置的一些配置"><a href="#4-前置的一些配置" class="headerlink" title="4.前置的一些配置"></a>4.前置的一些配置</h2></div>
<div class="note success"><h3 id="将scala框架添加到项目"><a href="#将scala框架添加到项目" class="headerlink" title="将scala框架添加到项目"></a>将scala框架添加到项目</h3></div>
<p>在IDEA启动后进入的界面中，可以看到界面左侧的项目界面，已经有一个名称为WordCount的工程。请在该工程名称上右键单击，在弹出的菜单中，选择Add Framework Surport ，在左侧有一排可勾选项，找到scala，勾选即可。<br><div class="note success"><h3 id="创建WordCount文件夹，并作为suorces-root"><a href="#创建WordCount文件夹，并作为suorces-root" class="headerlink" title="创建WordCount文件夹，并作为suorces root"></a>创建WordCount文件夹，并作为suorces root</h3></div></p>
<p>在src文件夹下创建一个WordCount文件夹。<br>右键新建的文件夹，按图把该文件夹设置为sources root。<br><img src="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/12.png" alt=""><br><div class="note success"><h2 id="5-两次的代码黏贴"><a href="#5-两次的代码黏贴" class="headerlink" title="5.两次的代码黏贴"></a>5.两次的代码黏贴</h2></div><br>黏贴wordcount代码到WordCount.scala<br>然后就可以通过右键刚刚设置为sources root的wordcount文件夹，就有了new-&gt;scala class的选项。<br>我们新建一个scala class，并且命名WordCount，选着为object类型。<br><img src="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/13.png" alt=""><br>我们打开建好的WordCount.scala文件，请空！然后黏贴以下代码：<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> org.apache.spark.<span class="type">SparkContext</span></div><div class="line"><span class="keyword">import</span> org.apache.spark.<span class="type">SparkContext</span>._</div><div class="line"><span class="keyword">import</span> org.apache.spark.<span class="type">SparkConf</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">object</span> <span class="title">WordCount</span> </span>&#123;</div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]) &#123;</div><div class="line">    <span class="keyword">val</span> inputFile =  <span class="string">"file:///usr/local/spark/mycode/wordcount/word.txt"</span></div><div class="line">    <span class="keyword">val</span> conf = <span class="keyword">new</span> <span class="type">SparkConf</span>().setAppName(<span class="string">"WordCount"</span>).setMaster(<span class="string">"local"</span>)</div><div class="line">    <span class="keyword">val</span> sc = <span class="keyword">new</span> <span class="type">SparkContext</span>(conf)</div><div class="line">    <span class="keyword">val</span> textFile = sc.textFile(inputFile)</div><div class="line">    <span class="keyword">val</span> wordCount = textFile.flatMap(line =&gt; line.split(<span class="string">" "</span>)).map(word =&gt; (word, <span class="number">1</span>)).reduceByKey((a, b) =&gt; a + b)</div><div class="line">    wordCount.foreach(println)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>黏贴pom.xml代码<br>现在我们把以下代码黏贴到pom.xml里。注意是全放在project标签内。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div></pre></td><td class="code"><pre><div class="line">&lt;properties&gt;</div><div class="line">        &lt;spark.version&gt;2.1.0&lt;/spark.version&gt;</div><div class="line">        &lt;scala.version&gt;2.11&lt;/scala.version&gt;</div><div class="line">    &lt;/properties&gt;</div><div class="line"></div><div class="line"></div><div class="line">    &lt;dependencies&gt;</div><div class="line">        &lt;dependency&gt;</div><div class="line">            &lt;groupId&gt;org.apache.spark&lt;/groupId&gt;</div><div class="line">            &lt;artifactId&gt;spark-core_$&#123;scala.version&#125;&lt;/artifactId&gt;</div><div class="line">            &lt;version&gt;$&#123;spark.version&#125;&lt;/version&gt;</div><div class="line">        &lt;/dependency&gt;</div><div class="line">        &lt;dependency&gt;</div><div class="line">            &lt;groupId&gt;org.apache.spark&lt;/groupId&gt;</div><div class="line">            &lt;artifactId&gt;spark-streaming_$&#123;scala.version&#125;&lt;/artifactId&gt;</div><div class="line">            &lt;version&gt;$&#123;spark.version&#125;&lt;/version&gt;</div><div class="line">        &lt;/dependency&gt;</div><div class="line">        &lt;dependency&gt;</div><div class="line">            &lt;groupId&gt;org.apache.spark&lt;/groupId&gt;</div><div class="line">            &lt;artifactId&gt;spark-sql_$&#123;scala.version&#125;&lt;/artifactId&gt;</div><div class="line">            &lt;version&gt;$&#123;spark.version&#125;&lt;/version&gt;</div><div class="line">        &lt;/dependency&gt;</div><div class="line">        &lt;dependency&gt;</div><div class="line">            &lt;groupId&gt;org.apache.spark&lt;/groupId&gt;</div><div class="line">            &lt;artifactId&gt;spark-hive_$&#123;scala.version&#125;&lt;/artifactId&gt;</div><div class="line">            &lt;version&gt;$&#123;spark.version&#125;&lt;/version&gt;</div><div class="line">        &lt;/dependency&gt;</div><div class="line">        &lt;dependency&gt;</div><div class="line">            &lt;groupId&gt;org.apache.spark&lt;/groupId&gt;</div><div class="line">            &lt;artifactId&gt;spark-mllib_$&#123;scala.version&#125;&lt;/artifactId&gt;</div><div class="line">            &lt;version&gt;$&#123;spark.version&#125;&lt;/version&gt;</div><div class="line">        &lt;/dependency&gt;</div><div class="line"></div><div class="line">    &lt;/dependencies&gt;</div><div class="line"></div><div class="line">    &lt;build&gt;</div><div class="line">        &lt;plugins&gt;</div><div class="line"></div><div class="line">            &lt;plugin&gt;</div><div class="line">                &lt;groupId&gt;org.scala-tools&lt;/groupId&gt;</div><div class="line">                &lt;artifactId&gt;maven-scala-plugin&lt;/artifactId&gt;</div><div class="line">                &lt;version&gt;2.15.2&lt;/version&gt;</div><div class="line">                &lt;executions&gt;</div><div class="line">                    &lt;execution&gt;</div><div class="line">                        &lt;goals&gt;</div><div class="line">                            &lt;goal&gt;compile&lt;/goal&gt;</div><div class="line">                            &lt;goal&gt;testCompile&lt;/goal&gt;</div><div class="line">                        &lt;/goals&gt;</div><div class="line">                    &lt;/execution&gt;</div><div class="line">                &lt;/executions&gt;</div><div class="line">            &lt;/plugin&gt;</div><div class="line"></div><div class="line">            &lt;plugin&gt;</div><div class="line">                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;</div><div class="line">                &lt;version&gt;3.6.0&lt;/version&gt;</div><div class="line">                &lt;configuration&gt;</div><div class="line">                    &lt;source&gt;1.8&lt;/source&gt;</div><div class="line">                    &lt;target&gt;1.8&lt;/target&gt;</div><div class="line">                &lt;/configuration&gt;</div><div class="line">            &lt;/plugin&gt;</div><div class="line"></div><div class="line">            &lt;plugin&gt;</div><div class="line">                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</div><div class="line">                &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;</div><div class="line">                &lt;version&gt;2.19&lt;/version&gt;</div><div class="line">                &lt;configuration&gt;</div><div class="line">                    &lt;skip&gt;true&lt;/skip&gt;</div><div class="line">                &lt;/configuration&gt;</div><div class="line">            &lt;/plugin&gt;</div><div class="line"></div><div class="line">        &lt;/plugins&gt;</div><div class="line">    &lt;/build&gt;</div></pre></td></tr></table></figure></p>
<p>黏贴好后，我们右键点击工程文件夹，更新一下，按下图操作。<br><img src="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/14.png" alt=""><br>这时候我们注意要记得点击右下角的“Import Changes Enables Auto-Import ”。如图。<br><img src="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/15.png" alt=""><br>这时候我们需要等待一段时间，可以看底部的进度条。等执行完毕，我们再进行后面的操作。</p>
<div class="note success"><h2 id="6-运行WordCount程序"><a href="#6-运行WordCount程序" class="headerlink" title="6.运行WordCount程序"></a>6.运行WordCount程序</h2></div>
<p>在WordCount.scala代码窗口内的任意位置，我们右键点击，可以唤出菜单，选择Run ‘WordCount’。运行的结果如下。注意根据代码，你必须有/usr/local/spark/mycode/wordcount/word.txt这个文件。输出信息较多，你可以拖动一下寻找结果信息。<br><img src="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/16.png" alt=""><br><div class="note success"><h2 id="7-打包WordCount程序的jar包"><a href="#7-打包WordCount程序的jar包" class="headerlink" title="7.打包WordCount程序的jar包"></a>7.打包WordCount程序的jar包</h2></div><br>首先打开File-&gt;Project Structure。如图。<br><img src="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/17-1.png" alt=""><br>然后选择Artifacts-&gt;绿色加号-&gt;Jar-&gt;From moduleswith dependencies…如图<br><img src="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/18.png" alt=""><br>选择Main Class，如图<br><img src="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/19.png" alt=""><br>然后因为我们只是在Spark上运行的，所以我们要删除下图红框里多余的部分，保留WordCount.jar以及‘WordCount’ compile output。小提示，这里可以利用Ctrl+A全选功能，选中全部选项，然后，配合Crtl+鼠标左键进行反选，也就是按住Ctrl键的同时用鼠标左键分别点击WordCount.jar和‘WordCount’ compile output，从而不选中这两项，最后，点击页面中的删除按钮（是一个减号图标），这样就把其他选项都删除，只保留了WordCount.jar以及‘WordCount’ compile output。<br><img src="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/20.png" alt=""><br>然后我们点击Apply，再点击OK，如图<br><img src="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/21.png" alt=""><br>接着我们就可以导出Jar包了。选择Build-&gt;Build Artifacts…，在弹出的窗口选择Bulid就可以了。如下图：<br><img src="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/22.png" alt=""><br>导出的Jar包会在工程文件“/home/wordcount/”目录下的“out/artifacts/WordCount_jar”目录下。我们把他复制到/home/hadoop目录下。也就是主文件夹目录下，如下图<br>实际上，可以用命令来复制WordCount.jar文件，请打开一个Linux终端，输入如下命令：<br><img src="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/02/23.png" alt=""><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> ~</div><div class="line">cp /home/hadoop/WordCount/out/artifacts/WordCount_jar/WordCount.jar /home/hadoop</div></pre></td></tr></table></figure></p>
<p>然后我们在终端执行以下命令，运行Jar包：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> ~</div><div class="line">/usr/<span class="built_in">local</span>/spark/bin/spark-submit --class WordCount /home/hadoop/WordCount.jar</div></pre></td></tr></table></figure></p>
<p>运行结果如下（输出的信息较多请上下翻一下就能找到），要求还是跟上述一样要有那个文件存在。<br>到此我们就完成了本次的任务了。</p>
<font color="grey">注：此博客参考自 厦门大学林子雨老师博客 仅供博主自身复习用</font>
      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        
  <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
    <div>坚持技术分享，您的支持将鼓励我继续创作！</div>
    <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
      <span>赏</span>
    </button>
    <div id="QR" style="display: none;">
      
        <div id="wechat" style="display: inline-block">
          <img id="wechat_qr" src="/img/wechat.png" alt="Melodylican WeChat Pay"/>
          <p>微信打赏</p>
        </div>
      
      
        <div id="alipay" style="display: inline-block">
          <img id="alipay_qr" src="/img/zhifubao.png" alt="Melodylican Alipay"/>
          <p>支付宝打赏</p>
        </div>
      
    </div>
  </div>


      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Spark/" rel="tag"># Spark</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/02/10/第一个Spark应用程序：WordCount/" rel="next" title="Spark入门 第二章 第二节 第一个Spark应用程序：WordCount">
                <i class="fa fa-chevron-left"></i> Spark入门 第二章 第二节 第一个Spark应用程序：WordCount
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/02/18/Spark集群环境的搭建/" rel="prev" title="Spark入门 第二章 第四节 Spark集群环境的搭建">
                Spark入门 第二章 第四节 Spark集群环境的搭建 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        
<script>
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='//bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
</script>

      
    </div>
  </div>

          
          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="uyan_frame"></div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.png"
               alt="Melodylican" />
          <p class="site-author-name" itemprop="name">Melodylican</p>
           
              <p class="site-description motion-element" itemprop="description">life is struggle</p>
          
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">90</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">8</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">67</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/rss2.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/your-user-name" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/your-user-name" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/u/3235750572" target="_blank" title="微博">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  微博
                </a>
              </span>
            
          
        </div>

        
        
          <div class="cc-license motion-element" itemprop="license">
            <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" target="_blank">
              <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons" />
            </a>
          </div>
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              友情链接
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.baidu.com/" title="MacTalk" target="_blank">MacTalk</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://example.com/" title="Title" target="_blank">Title</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-安装IntelliJ-IDEA"><span class="nav-number">1.</span> <span class="nav-text">1.安装IntelliJ IDEA</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-在Intellij里安装scala插件，并配置JDK，scala-SDK"><span class="nav-number">2.</span> <span class="nav-text">2.在Intellij里安装scala插件，并配置JDK，scala SDK</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#配置JDK"><span class="nav-number">2.1.</span> <span class="nav-text">## 配置JDK ##</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置全局Scala-SDK"><span class="nav-number">2.2.</span> <span class="nav-text">## 配置全局Scala SDK ##</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-创建Maven工程文件"><span class="nav-number">3.</span> <span class="nav-text">3.创建Maven工程文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-前置的一些配置"><span class="nav-number">4.</span> <span class="nav-text">4.前置的一些配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#将scala框架添加到项目"><span class="nav-number">4.1.</span> <span class="nav-text">将scala框架添加到项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建WordCount文件夹，并作为suorces-root"><span class="nav-number">4.2.</span> <span class="nav-text">创建WordCount文件夹，并作为suorces root</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-两次的代码黏贴"><span class="nav-number">5.</span> <span class="nav-text">5.两次的代码黏贴</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-运行WordCount程序"><span class="nav-number">6.</span> <span class="nav-text">6.运行WordCount程序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-打包WordCount程序的jar包"><span class="nav-number">7.</span> <span class="nav-text">7.打包WordCount程序的jar包</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2012 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Powered By <a href="#">Melodylican</a></span>
</div>


<div class="powered-by">
    个人专属
</div>

<div class="theme-info">
  博客 
  
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

  
  <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  
    

    
      <!-- UY BEGIN -->
      <script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2128487"></script>
      <!-- UY END -->
    
  





  



  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="local-search-pop-overlay">').css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("nCYvmPGeqGhuuM0qkwvIf2k1-gzGzoHsz", "dnC7e97rmSEwVQKrjxAE7oRR");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  


  
  
	<script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>
  
<!-- 小红心 -->
<script type="text/javascript" src="/js/src/love.js"></script>
</body>
</html>
